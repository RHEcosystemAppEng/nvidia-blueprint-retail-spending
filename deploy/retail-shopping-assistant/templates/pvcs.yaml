{{/*
SPDX-FileCopyrightText: Copyright (c) 2024-2026 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
SPDX-License-Identifier: Apache-2.0
*/}}

{{/*
Shared Data PVC
*/}}
{{- if .Values.persistence.sharedData.enabled }}
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ include "retail-shopping-assistant.sharedDataPvc.name" . }}
  namespace: {{ include "retail-shopping-assistant.namespace" . }}
  labels:
    {{- include "retail-shopping-assistant.labels" . | nindent 4 }}
spec:
  accessModes:
    - {{ .Values.persistence.sharedData.accessMode }}
  resources:
    requests:
      storage: {{ .Values.persistence.sharedData.size }}
  {{- if (include "retail-shopping-assistant.storageClassRWX" .) }}
  storageClassName: {{ include "retail-shopping-assistant.storageClassRWX" . }}
  {{- end }}
{{- end }}
{{/*
Milvus Data PVC
*/}}
{{- if and .Values.milvus.enabled (not .Values.milvus.useOperator) (not .Values.milvus.external.enabled) .Values.milvus.persistence.enabled }}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ include "retail-shopping-assistant.milvus.name" . }}-data
  namespace: {{ include "retail-shopping-assistant.namespace" . }}
  labels:
    {{- include "retail-shopping-assistant.labels" . | nindent 4 }}
    app.kubernetes.io/component: milvus
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ .Values.milvus.persistence.size }}
  {{- if (include "retail-shopping-assistant.storageClass" .) }}
  storageClassName: {{ include "retail-shopping-assistant.storageClass" . }}
  {{- end }}
{{- end }}
{{/*
etcd Data PVC
*/}}
{{- if and .Values.etcd.enabled .Values.etcd.persistence.enabled }}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ include "retail-shopping-assistant.etcd.name" . }}-data
  namespace: {{ include "retail-shopping-assistant.namespace" . }}
  labels:
    {{- include "retail-shopping-assistant.labels" . | nindent 4 }}
    app.kubernetes.io/component: etcd
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ .Values.etcd.persistence.size }}
  {{- if (include "retail-shopping-assistant.storageClass" .) }}
  storageClassName: {{ include "retail-shopping-assistant.storageClass" . }}
  {{- end }}
{{- end }}
{{/*
MinIO Data PVC
*/}}
{{- if and .Values.minio.enabled .Values.minio.persistence.enabled }}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ include "retail-shopping-assistant.minio.name" . }}-data
  namespace: {{ include "retail-shopping-assistant.namespace" . }}
  labels:
    {{- include "retail-shopping-assistant.labels" . | nindent 4 }}
    app.kubernetes.io/component: minio
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ .Values.minio.persistence.size }}
  {{- if (include "retail-shopping-assistant.storageClass" .) }}
  storageClassName: {{ include "retail-shopping-assistant.storageClass" . }}
  {{- end }}
{{- end }}
{{/*
PostgreSQL Data PVC
*/}}
{{- if and .Values.postgresql.enabled .Values.postgresql.persistence.enabled }}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ include "retail-shopping-assistant.postgresql.name" . }}-data
  namespace: {{ include "retail-shopping-assistant.namespace" . }}
  labels:
    {{- include "retail-shopping-assistant.labels" . | nindent 4 }}
    app.kubernetes.io/component: postgresql
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ .Values.postgresql.persistence.size }}
  {{- if (include "retail-shopping-assistant.storageClass" .) }}
  storageClassName: {{ include "retail-shopping-assistant.storageClass" . }}
  {{- end }}
{{- end }}
